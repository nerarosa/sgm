var cbpBGSlideshow,curVideo,totalVideo,player,audiobookSourceType=document.getElementById("book-play-source").getAttribute("data-abhost"),audiobookSource=document.getElementById("book-play-source").getAttribute("data-absource");
if("yt"==audiobookSourceType){var updateProgressBar=function(){var a=player.getCurrentTime()/player.getDuration()*100;$(".progress-bar span").css("width",a+"%").text(a+"%")},formatTime=function(a){a=Math.round(a);var f=Math.floor(a/3600),b=Math.floor((a-3600*f)/60);a=a-3600*f-60*b;a=10>a?"0"+a:a;return 0<f?f+":"+b+":"+a:b+":"+a},updateTimerDisplay=function(){$("#current-time").text(formatTime(player.getCurrentTime()));$("#duration").text(formatTime(player.getDuration()))},onPlayerStateChange=function(a){a.data==
YT.PlayerState.PLAYING&&setInterval(function(){$(".play-book span").text(formatTime(player.getCurrentTime()))},1E3);1==plist&&a.data==YT.PlayerState.CUED&&(totalVideo=a.target.getPlaylist().length,curVideo=a.target.getPlaylistIndex(),$("#current-time").before('<span id="plist-info">Ph\u1ea7n <span>'+(curVideo+1)+"</span>/"+totalVideo+"</span>"),$(".play-book span").text(formatTime(a.target.getDuration())))},initialize=function(a){1==plist&&a.target.cuePlaylist({listType:"playlist",list:audiobookSource,
index:0,suggestedQuality:"small"});updateTimerDisplay();updateProgressBar();0==plist&&$(".play-book span").text(formatTime(player.getDuration()));clearInterval(time_update_interval);time_update_interval=setInterval(function(){updateTimerDisplay();updateProgressBar()},1E3)},onYouTubeIframeAPIReady=function(){player=0==plist?new YT.Player("video-placeholder",{width:600,height:400,videoId:audiobookSource,playerVars:{color:"white",autoplay:0},events:{onReady:initialize,onStateChange:onPlayerStateChange}}):
new YT.Player("video-placeholder",{width:600,height:400,playerVars:{color:"white",autoplay:0},events:{onReady:initialize,onStateChange:onPlayerStateChange}})};(function(a){function f(a,b){for(var h in b)b.hasOwnProperty(h)&&(a[h]=b[h]);return a}function b(a,b){this.el=a;this.options=f({},this.options);f(this.options,b);this._init()}var g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")],
c=Modernizr.csstransitions;b.prototype.options={closeEl:"",onBeforeOpen:function(){return!1},onAfterOpen:function(){return!1},onBeforeClose:function(){return!1},onAfterClose:function(){return!1}};b.prototype._init=function(){this.button=this.el.querySelector("button");this.expanded=!1;this.contentEl=this.el.querySelector(".morph-content");this._initEvents()};b.prototype._initEvents=function(){var a=this;this.button.addEventListener("click",function(){a.toggle()});if(""!==this.options.closeEl){var b=
this.el.querySelector(this.options.closeEl);b&&b.addEventListener("click",function(){a.toggle()})}};b.prototype.toggle=function(){if(this.isAnimating)return!1;if(this.expanded)this.options.onBeforeClose();else classie.addClass(this.el,"active"),this.options.onBeforeOpen();this.isAnimating=!0;var a=this,b=function(d){if(d.target!==this)return!1;if(c){if(a.expanded&&"opacity"!==d.propertyName||!a.expanded&&"width"!==d.propertyName&&"height"!==d.propertyName&&"left"!==d.propertyName&&"top"!==d.propertyName)return!1;
this.removeEventListener(g,b)}a.isAnimating=!1;if(a.expanded)classie.removeClass(a.el,"active"),a.options.onAfterClose();else a.options.onAfterOpen();a.expanded=!a.expanded};c?this.contentEl.addEventListener(g,b):b();var d=this.button.getBoundingClientRect();classie.addClass(this.contentEl,"no-transition");this.contentEl.style.left="auto";this.contentEl.style.top="auto";setTimeout(function(){a.contentEl.style.left=d.left+"px";a.contentEl.style.top=d.top+"px";a.expanded?(classie.removeClass(a.contentEl,
"no-transition"),classie.removeClass(a.el,"open")):setTimeout(function(){classie.removeClass(a.contentEl,"no-transition");classie.addClass(a.el,"open")},25)},25)};a.UIMorphingButton=b})(window);var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var plist=!1;11<audiobookSource.length&&(plist=!0);var time_update_interval;(function(){function a(){window.scrollTo(e?
e.x:0,e?e.y:0)}function f(){window.removeEventListener("scroll",g);window.addEventListener("scroll",a)}function b(){window.addEventListener("scroll",g)}function g(){h||(h=!0,setTimeout(function(){e={x:window.pageXOffset||c.scrollLeft,y:window.pageYOffset||c.scrollTop};h=!1},60))}var c=window.document.documentElement,h,e;b();var d=document.querySelector(".morph-button");new UIMorphingButton(d,{closeEl:".icon-close",onBeforeOpen:function(){f();player.playVideo()},onAfterOpen:function(){window.removeEventListener("scroll",
a);b();classie.addClass(document.body,"noscroll");classie.addClass(document.documentElement,"noscroll");classie.addClass(d,"scroll")},onBeforeClose:function(){classie.removeClass(document.body,"noscroll");classie.removeClass(document.documentElement,"noscroll");classie.removeClass(d,"scroll");f()},onAfterClose:function(){window.removeEventListener("scroll",a);b();player.pauseVideo()}})})();(function(a,f){a.fn.imagesLoaded=function(b){function g(){var c=a(q),n=a(p);d&&(p.length?d.reject(k,c,n):d.resolve(k));
a.isFunction(b)&&b.call(e,k,c,n)}function c(a){h(a.target,"error"===a.type)}function h(b,n){"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="===b.src||-1!==a.inArray(b,m)||(m.push(b),n?p.push(b):q.push(b),a.data(b,"imagesLoaded",{isBroken:n,src:b.src}),l&&d.notifyWith(a(b),[n,k,a(q),a(p)]),k.length===m.length&&(setTimeout(g),k.unbind(".imagesLoaded",c)))}var e=this,d=a.isFunction(a.Deferred)?a.Deferred():0,l=a.isFunction(d.notify),k=e.find("img").add(e.filter("img")),m=[],q=
[],p=[];a.isPlainObject(b)&&a.each(b,function(a,c){if("callback"===a)b=c;else if(d)d[a](c)});k.length?k.bind("load.imagesLoaded error.imagesLoaded",c).each(function(b,c){var d=c.src,e=a.data(c,"imagesLoaded");if(e&&e.src===d)h(c,e.isBroken);else if(c.complete&&c.naturalWidth!==f)h(c,0===c.naturalWidth||0===c.naturalHeight);else if(c.readyState||c.complete)c.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",c.src=d}):g();return d?d.promise(e):e}})(jQuery);cbpBGSlideshow=
function(){function a(){d.$navPlayPause.on("click",function(){var a=$(this);a.hasClass("cbp-biplay")?(a.removeClass("cbp-biplay").addClass("cbp-bipause"),player.playVideo(),b()):(a.removeClass("cbp-bipause").addClass("cbp-biplay"),player.pauseVideo(),m=!1,clearTimeout(k))});d.$navPrev.on("click",function(){f("prev");1==plist&&(player.previousVideo(),1<$("#plist-info span").text()&&$("#plist-info span").text(parseInt($("#plist-info span").text())-1));m&&b()});d.$navNext.on("click",function(){1==plist&&
(player.nextVideo(),$("#plist-info span").text()<totalVideo&&$("#plist-info span").text(parseInt($("#plist-info span").text())+1));f("next");m&&b()})}function f(a){var b=c.eq(l);"next"===a?l=l<h-1?++l:0:"prev"===a&&(l=0<l?--l:h-1);a=c.eq(l);b.css("opacity",0);a.css("opacity",1)}function b(){m=!0;clearTimeout(k);k=setTimeout(function(){f("next");b()},3500)}var g=$("#cbp-bislideshow"),c=g.children("li"),h=c.length,e=$("#cbp-bicontrols"),d={$navPrev:e.find("span.cbp-biprev"),$navNext:e.find("span.cbp-binext"),
$navPlayPause:e.find("span.cbp-bipause")},l=0,k,m=!0;return{init:function(d){g.imagesLoaded(function(){Modernizr.backgroundsize?c.each(function(){var a=$(this);a.css("background-image","url("+a.find("img").attr("src")+")")}):g.find("img").show();c.eq(l).css("opacity",1);a();b()})}}}()}
$(function(){var a=$(".book-info").html(),f=sgmTags("author",a),a=sgmTags("sum",a);$(".mockup-right .book-author a").text(f);$(".mockup-right .book-summary").html(a);if("yt"==audiobookSourceType){cbpBGSlideshow.init();var b=!1;$(".progress-bar").mousedown(function(a){b=!0;g(a.pageX)});$(document).mouseup(function(a){b&&(b=!1,g(a.pageX))});$(document).mousemove(function(a){b&&g(a.pageX)});var g=function(a){var b=$(".progress-bar"),c=player.getDuration();a=100*(a-b.offset().left)/b.width();console.log(a);
100<a&&(a=100);0>a&&(a=0);$(".progress-bar span").css("width",a+"%");player.seekTo(c*a/100)}}else"mix"==audiobookSourceType&&($(".morph-content").hide(),$(".play-book span").hide(),$(".play-book").on("click",function(){0>=$("#audio-player").length&&$(".entry-content section.ab-content-wrap").before('<div id="audio-player"><iframe width="100%" height="120" src="https://www.mixcloud.com/widget/iframe/?feed='+encodeURIComponent(audiobookSource)+'&hide_cover=1&autoplay=1" frameborder="0"></iframe></div>');
$(this).hide();$("html, body").animate({scrollTop:$(".post.hentry").offset().top},"slow");return!1}))});